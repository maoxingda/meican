- [x] **历年来**：从什么时候开始？**<font color=red>2016</font>**

- [x] 逐月统计：结果是否只需要在下个月出上个月及以前的结果？**<font color=red>没问题</font>**

- [x] 某个客户当月是新增【大客户】，下个月变成【普通客户】，第1个月留存该客户算大客户还是小客户，还是什么都不算？<font color=red>变成小客户加到小客户，变成大客户加到大客户</font>

   | 当月新增用户  | 第1个月 | 第2个月                    | 第3个月                    | 第4个月 | 第5个月                    |
   | ------------- | ------- | -------------------------- | -------------------------- | ------- | -------------------------- |
   | 大客户a, b, c | abc     | ab                         | ab<font color=red>c</font> | ab      | ab<font color=red>c</font> |
   | 小客户d, e    | de      | <font color=red>c</font>de | de                         | de      | de                         |

- [x] 需要从客户上线以来的所有历史留存？<font color=red>是</font>

- [x] <font color=red>需要补数据</font>

- [ ] 筛选条件中的【城市】是干嘛用的？客户下线是所有城市，所有餐别都没有订单？

- [ ] 三张表中的【城市】各是什么作用？

- [ ] 取用餐时间而不是订单产生时间（online_date：target_date）

- [ ] gmv用total_paid求和

```sql
create table ads.retention_client
(
	online_date varchar, 	  -- 上线日期（粒度：yyyy-MM）
  nth_month int,					-- 第几月留存
  online_cnt int,					-- 上线用户数
  retention_cnt int, 			-- 留存用户数
  retention_ratio float, 	-- 留存率
  client_type int,				-- 用户类型（大客户 | 小客户）
  city varchar,						-- 城市
  gmv_owner varchar				-- 销售额归属
)
```

```sql
create table ads.offline_client_history
(
  client_name varchar,			-- 用户名称
  online_date date,					-- 上线日期
  offline_date date,				-- 下线日期
  history_total_gmv float,	-- 历史gmv
  month_avg_gmv float,			-- 月平均gmv
  client_members int,				-- 客户成员数
  meal_plans int 					  -- 用餐计划（餐别）数
)
```

```sql
create table ads.offline_meal_plan_history
(
  meal_plan_name varchar,		-- 餐别名称
  online_date date,					-- 上线日期
  offline_date date,				-- 下线日期
  history_total_gmv float,	-- 历史gmv
  month_avg_gmv float,			-- 月平均gmv
  client_members int				-- 客户成员数
)
```

| 客户id-维度 | 上线月份-客户属性 | 餐别-维度 | 城市-餐别属性 | 销售额归属-客户属性 | 统计月份-维度 | 在线状态 | 下线时间 | 统计金额 |
| ----------- | ----------------- | --------- | ------------- | ------------------- | ------------- | -------- | -------- | -------- |
|             |                   |           |               |                     |               |          |          |          |

